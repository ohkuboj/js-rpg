<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini RPG</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .log { white-space: pre-line; background: #f0f0f0; padding: 10px; margin-top: 10px; }
    button { padding: 10px 15px; margin-top: 10px; }
    .hp-bar {
      width: 200px;
      height: 20px;
      background-color: #ccc;
      border: 1px solid #999;
      border-radius: 4px;
      margin-top: 2px;
    }

    .hp-fill {
      height: 100%;
      background-color: #4caf50;
      width: 100%; /* Default full */
      border-radius: 4px;
      transition: width 0.3s ease;
    }

  </style>
</head>
<body>
  <h1>‚öîÔ∏è Mini RPG</h1>
  <div id="game">
    <input type="text" id="playerName" placeholder="Enter your name">
      
    <label for="playerClass">Choose your class:</label>
    <select id="playerClass">
      <option value="warrior">Warrior</option>
      <option value="mage">Mage</option>
      <option value="rogue">Rogue</option>
    </select>
    <button onclick="startGame()">Start Game</button>
  </div>

  <div id="battle" style="display:none;">
    <h2 id="status"></h2>
    <img id="portrait" src="" alt="Character Portrait" style="width: 150px; display: block; margin-top: 10px;">
    
  <div>
    <strong id="playerNameLabel"></strong>
    <div class="hp-bar">
      <div id="playerHpFill" class="hp-fill"></div>
    </div>
  </div>

  <div style="margin-top: 10px;">
    <strong id="enemyNameLabel"></strong>
    <div class="hp-bar">
      <div id="enemyHpFill" class="hp-fill"></div>
    </div>
  </div>
  
  <button onclick="playerAttack()">Attack</button>
  <button onclick="useAbility()">Use Special Ability</button>
  <button onclick="restartGame()" style="display:none;" id="restartBtn">Restart</button>
  <div class="log" id="log"></div>
</div>

  <script>
    window.onload = function () {
      const savedClass = localStorage.getItem("rpgClass");
      if (savedClass) {
        document.getElementById("playerClass").value = savedClass;
      }
    };


    let player, enemy;

    function capitalize(str) {
      return str.charAt(0).toUpperCase() + str.slice(1);
      }

    function updateStatus() {
      document.getElementById("status").textContent =
        `${player.name} (${capitalize(player.class)}) HP: ${player.hp} | ATK: ${player.attack} | DEF: ${player.defense} | Enemy (${enemy.name}) HP: ${enemy.hp}`;

      // Set HP bar widths
      const playerHpPercent = Math.max(0, (player.hp / player.maxHp) * 100);
      const enemyHpPercent = Math.max(0, (enemy.hp / enemy.maxHp) * 100);

      document.getElementById("playerHpFill").style.width = `${playerHpPercent}%`;
      document.getElementById("enemyHpFill").style.width = `${enemyHpPercent}%`;

      // Set labels
      document.getElementById("playerNameLabel").textContent = `${player.name}`;
      document.getElementById("enemyNameLabel").textContent = `${enemy.name}`;
    }

      

    function startGame() {
      const name = document.getElementById("playerName").value || "Hero";
      const selectedClass = document.getElementById("playerClass").value;
      const portrait = document.getElementById("portrait");

      portrait.onerror = function () {
        portrait.src = "img/default.png";
      };

      let hp, attack, defense, crit;

      // Assign stats and portrait based on class
      if (selectedClass === "warrior") {
        hp = 40;
        attack = 8;
        defense = 5;
        crit = 0.1; // 10%
        portrait.src = "img/warrior.png";
      } else if (selectedClass === "mage") {
        hp = 25;
        attack = 12;
        defense = 2;
        crit = 0.25; // 25%
        portrait.src = "img/mage.png";
      } else if (selectedClass === "rogue") {
        hp = 30;
        attack = 10;
        defense = 3;
        crit = 0.2; // 20%
        portrait.src = "img/rogue.png";
      }

      player = {
        name,
        class: selectedClass,
        hp,
        maxHp: hp,
        attack,
        defense,
        crit,
        usedAbility: false 
      };

      localStorage.setItem("rpgClass", selectedClass);

      enemy = {
        name: "Goblin",
        hp: 20,
        maxHp: 20,
        attack: 6,
        defense: 1,
        crit: 0.05
      };
            
      document.getElementById("game").style.display = "none";
      document.getElementById("battle").style.display = "block";
      updateStatus();
      log(`${player.name} the ${capitalize(player.class)} enters battle against ${enemy.name}!\n`);
    }

    function playerAttack() {
      if (!player.hp || !enemy.hp) return;

      let baseDamage = Math.floor(Math.random() * player.attack) + 1;
      let isCrit = Math.random() < player.crit;
      let totalDamage = isCrit ? baseDamage * 2 : baseDamage;

      totalDamage = Math.max(0, totalDamage - enemy.defense);

      log(`${player.name} attacks for ${totalDamage} damage${isCrit ? ' (CRITICAL!)' : ''}.`);
      enemy.hp -= totalDamage;

      if (enemy.hp <= 0) {
        enemy.hp = 0;
        updateStatus();
        log(`${enemy.name} is defeated! üéâ`);
        document.getElementById("restartBtn").style.display = "inline-block";
        return;
      }


      if (player.hp <= 0) {
        player.hp = 0;
        updateStatus();
        log(`${player.name} was defeated... üíÄ`);
        document.getElementById("restartBtn").style.display = "inline-block";
        return;
      }

      updateStatus();
      enemyTurn();
    }

    function enemyTurn() {
      let baseDamage = Math.floor(Math.random() * enemy.attack) + 1;
      let isCrit = Math.random() < enemy.crit;
      let totalDamage = isCrit ? baseDamage * 2 : baseDamage;

      totalDamage = Math.max(0, totalDamage - player.defense);

      log(`${enemy.name} attacks for ${totalDamage} damage${isCrit ? ' (CRITICAL!)' : ''}.`);
      player.hp -= totalDamage;

      if (player.hp <= 0) {
        player.hp = 0;
        updateStatus();
        log(`${player.name} was defeated... üíÄ`);
        document.getElementById("restartBtn").style.display = "inline-block";
        return;
      }

      updateStatus();
    }

    function useAbility() {
      if (!player.hp || !enemy.hp) return;

        // Check if ability was already used
      if (player.usedAbility) {
        log(`${player.name} has already used their special ability!`);
        return;
      }

      // Mark ability as used
      player.usedAbility = true;
      document.querySelector('button[onclick="useAbility()"]').disabled = true;

      let damage = 0;
      if (player.class === "warrior") {
        damage = Math.floor(Math.random() * player.attack) + 1;
        damage *= 2;
        log(`${player.name} uses Shield Bash! Deals ${damage} damage!`);
      } else if (player.class === "mage") {
        damage = Math.floor(Math.random() * 7) + 12; // 12‚Äì18
        log(`${player.name} casts Fireball! Deals ${damage} damage!`);
      } else if (player.class === "rogue") {
        let hit1 = Math.floor(Math.random() * 5) + 4; // 4‚Äì8
        let hit2 = Math.floor(Math.random() * 5) + 4;
        damage = hit1 + hit2;
        log(`${player.name} strikes twice! ${hit1} + ${hit2} = ${damage} damage!`);
      }


      enemy.hp -= damage;
      if (enemy.hp <= 0) {
        enemy.hp = 0;
        updateStatus();
        log(`${enemy.name} is defeated by your special move! üéâ`);
        document.getElementById("restartBtn").style.display = "inline-block";
        return;
      }
      document.querySelector('button[onclick="useAbility()"]').disabled = true;

      updateStatus();
      // Enemy counterattacks
      enemyTurn();

      if (player.hp <= 0) {
        player.hp = 0;
        updateStatus();
        log(`${player.name} was defeated... üíÄ`);
        document.getElementById("restartBtn").style.display = "inline-block";
        return;
      }

      updateStatus();
    }

  
    function log(message) {
      const logDiv = document.getElementById("log");
      logDiv.textContent += message + '\n';
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function restartGame() {
      // Clear previous log
      document.getElementById("log").textContent = '';
      // Reset UI
      document.getElementById("battle").style.display = "none";
      document.getElementById("game").style.display = "block";
      document.getElementById("restartBtn").style.display = "none";
      // Clear input if you want
      document.getElementById("playerName").value = '';
      document.querySelector('button[onclick="useAbility()"]').disabled = false;
    }
  </script>
</body>
</html>